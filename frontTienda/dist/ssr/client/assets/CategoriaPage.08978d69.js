import{Q as B}from"./QSkeleton.b801fe91.js";import{c as H,a as w,h as v,f as L,b5 as M,aE as J,r as D,a$ as K,b6 as X,w as Q,o as Y,Q as _,a4 as f,g as Z,L as $,_ as ee,$ as n,a0 as g,a1 as d,a2 as c,ac as m,a8 as b,aj as A,a3 as l,ad as y,a9 as P,aa as q,b0 as V,af as h,au as j,ag as te,ah as ae,ak as se,al as oe}from"./index.534612a3.js";import{a as z,Q as S}from"./QItemSection.ab475864.js";import{Q as ne}from"./QList.ba69b5e6.js";import{Q as ie}from"./QMenu.8e8da661.js";import{Q as re}from"./QSpinnerDots.43034d1d.js";import{Q as le}from"./QBadge.0c11437b.js";import{Q as ce}from"./QImg.a5adf003.js";import{Q as ue}from"./QPage.1888b0c5.js";var de=H({name:"QBtnGroup",props:{unelevated:Boolean,outline:Boolean,flat:Boolean,rounded:Boolean,square:Boolean,push:Boolean,stretch:Boolean,glossy:Boolean,spread:Boolean},setup(e,{slots:a}){const u=w(()=>{const r=["unelevated","outline","flat","rounded","square","push","stretch","glossy"].filter(t=>e[t]===!0).map(t=>`q-btn-group--${t}`).join(" ");return`q-btn-group row no-wrap${r.length!==0?" "+r:""}`+(e.spread===!0?" q-btn-group--spread":" inline")});return()=>v("div",{class:u.value},L(a.default))}});const be=Object.keys(M),ge=e=>be.reduce((a,u)=>{const r=e[u];return r!==void 0&&(a[u]=r),a},{});var he=H({name:"QBtnDropdown",props:{...M,...J,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(e,{slots:a,emit:u}){const{proxy:r}=Z(),t=D(e.modelValue),i=D(null),s=K(),k=w(()=>{const o={"aria-expanded":t.value===!0?"true":"false","aria-haspopup":"true","aria-controls":s,"aria-label":e.toggleAriaLabel||r.$q.lang.label[t.value===!0?"collapse":"expand"](e.label)};return(e.disable===!0||e.split===!1&&e.disableMainBtn===!0||e.disableDropdown===!0)&&(o["aria-disabled"]="true"),o}),O=w(()=>"q-btn-dropdown__arrow"+(t.value===!0&&e.noIconAnimation===!1?" rotate-180":"")+(e.split===!1?" q-btn-dropdown__arrow-container":"")),N=w(()=>X(e)),x=w(()=>ge(e));Q(()=>e.modelValue,o=>{i.value!==null&&i.value[o?"show":"hide"]()}),Q(()=>e.split,C);function F(o){t.value=!0,u("beforeShow",o)}function R(o){u("show",o),u("update:modelValue",!0)}function G(o){t.value=!1,u("beforeHide",o)}function T(o){u("hide",o),u("update:modelValue",!1)}function E(o){u("click",o)}function W(o){$(o),C(),u("click",o)}function U(o){i.value!==null&&i.value.toggle(o)}function I(o){i.value!==null&&i.value.show(o)}function C(o){i.value!==null&&i.value.hide(o)}return Object.assign(r,{show:I,hide:C,toggle:U}),Y(()=>{e.modelValue===!0&&I()}),()=>{const o=[v(_,{class:O.value,name:e.dropdownIcon||r.$q.iconSet.arrow.dropdown})];return e.disableDropdown!==!0&&o.push(v(ie,{ref:i,id:s,class:e.contentClass,style:e.contentStyle,cover:e.cover,fit:!0,persistent:e.persistent,noRouteDismiss:e.noRouteDismiss,autoClose:e.autoClose,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,separateClosePopup:!0,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:F,onShow:R,onBeforeHide:G,onHide:T},a.default)),e.split===!1?v(f,{class:"q-btn-dropdown q-btn-dropdown--simple",...x.value,...k.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:E},{default:()=>L(a.label,[]).concat(o),loading:a.loading}):v(de,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:e.rounded,square:e.square,...N.value,glossy:e.glossy,stretch:e.stretch},()=>[v(f,{class:"q-btn-dropdown--current",...x.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:W},{default:a.label,loading:a.loading}),v(f,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...k.value,...N.value,disable:e.disable===!0||e.disableDropdown===!0,rounded:e.rounded,color:e.color,textColor:e.textColor,dense:e.dense,size:e.size,padding:e.padding,ripple:e.ripple},()=>o)])}}});const me={name:"CategoriaPage",props:{id:{type:[String,Number],required:!0}},data(){return{productos:[],subcategorias:[],loadingSubcats:!1,loading:!1,categoriaNombre:"",subNombre:"",subId:null,currentPage:1,totalPages:1,isFetched:!1,itemsPerPage:20}},async mounted(){await this.fetchCategoria(),await this.fetchSubcategorias(),await this.fetchProductos()},watch:{id(){this.currentPage=1,this.subId=null,this.subNombre="",this.fetchCategoria(),this.fetchSubcategorias(),this.fetchProductos()}},methods:{async fetchCategoria(){try{const{data:e}=await this.$axios.get(`categories/${this.id}`);this.categoriaNombre=e.name}catch{this.categoriaNombre="Desconocida"}},async fetchSubcategorias(){this.loadingSubcats=!0;try{const{data:e}=await this.$axios.get("subcategories",{params:{category_id:this.id}}),a=Array.isArray(e)?e:e.data||[],u=Number(this.id);this.subcategorias=a.filter(r=>Number(r.category_id)===u),this.setSubNombre()}catch{this.subcategorias=[],this.subNombre=""}finally{this.loadingSubcats=!1}},setSubNombre(){if(!this.subId&&this.subId!==0){this.subNombre="";return}const e=this.subcategorias.find(a=>Number(a.id)===Number(this.subId));this.subNombre=e?e.name:""},async fetchProductos(){this.loading=!0,this.isFetched=!1,this.productos=[];try{const a=(await this.$axios.get("productsSale",{params:{category:this.id,page:this.currentPage,subcategory_id:this.subId||void 0,subcategory:this.subId||void 0}})).data.products,u=a&&a.data?a.data:[];u.length>0?(this.productos=u.map(r=>{const t={...r},i=[r.cantidadSucursal1,r.cantidadSucursal2,r.cantidadSucursal3,r.cantidadSucursal4,r.cantidadSucursal5,r.cantidadSucursal6,r.cantidadSucursal7].some(s=>s>0);return t.stockDisponible=i?"Disponible":"Sin Stock",t}),this.totalPages=a.last_page||1):(this.productos=[],this.totalPages=1)}catch(e){console.error("Error al cargar productos:",e),this.productos=[],this.totalPages=1}finally{this.loading=!1,this.isFetched=!0}},seleccionarSubcat(e){this.subId=e,this.currentPage=1,this.setSubNombre(),this.fetchProductos()},cambiarPagina(e){e<1||e>this.totalPages||(this.currentPage=e,this.fetchProductos())},resolverImagen(e){const a=e==null?void 0:e.imagen;return a?a.includes("http")?a:`${this.$url}../images/${a}`:`${this.$url}../images/noimagen.jpg`},clickDetalleProducto(e){this.$router.push("/detalle-producto/"+e.id+"/"+this.espacioCambioGuion(e.nombre))},espacioCambioGuion(e){return e.replace(/ |\/|\./g,"-").replace(/,/g,"")}}},p=e=>(se("data-v-e0bdd91a"),e=e(),oe(),e),fe={class:"sidebar-subcats"},_e=p(()=>c("div",{class:"aside-title"},"Subcategor\xEDas",-1)),ve=["onClick"],pe={key:0,class:"subcat-empty"},ye={class:"subcats-mobile"},Se={class:"page-wrapper q-pa-md contenido"},ke={class:"text-h5 titulo"},we={key:0,class:"chip"},Pe={key:0,class:"pagination-controls text-center q-mt-lg"},Ce={key:1,class:"text-center q-mt-lg"},Be={key:2,class:"text-center q-mt-lg"},qe=p(()=>c("div",{class:"text-h6 q-mt-md"},"No hay productos en esta categor\xEDa",-1)),Ne={key:3,class:"contenedor-productos"},xe={class:"products-grid"},Ie={key:0,class:"out-of-stock-overlay"},De=p(()=>c("span",{class:"out-of-stock-text"},"Sin Stock",-1)),Qe=[De],Ae={class:"product-name"},Ve={class:"product-prices"},je={key:0,class:"price-old"},ze=p(()=>c("span",null,"Antes",-1)),He=p(()=>c("br",null,null,-1)),Le={class:"price-now"},Me=p(()=>c("span",null,"Ahora",-1)),Oe=p(()=>c("br",null,null,-1)),Fe={key:0,class:"pagination-controls text-center q-mt-lg"};function Re(e,a,u,r,t,i){return n(),g(ue,{class:"q-pa-none"},{default:d(()=>[c("aside",fe,[_e,t.loadingSubcats?(n(),g(B,{key:0,type:"text",class:"q-mb-sm"})):m("",!0),t.loadingSubcats?(n(),g(B,{key:1,type:"text",class:"q-mb-sm"})):m("",!0),t.loadingSubcats?(n(),g(B,{key:2,type:"text",class:"q-mb-sm"})):(n(),b(P,{key:3},[c("div",{class:A(["subcat-item",{active:t.subId===null}]),onClick:a[0]||(a[0]=s=>i.seleccionarSubcat(null))},[l(_,{name:"grid_view",size:"18px",class:"q-mr-sm"}),y(" Todas ")],2),(n(!0),b(P,null,q(t.subcategorias,s=>(n(),b("div",{key:s.id,class:A(["subcat-item",{active:Number(t.subId)===Number(s.id)}]),onClick:k=>i.seleccionarSubcat(s.id)},[l(_,{name:"label",size:"18px",class:"q-mr-sm"}),y(" "+h(s.name),1)],10,ve))),128)),t.subcategorias.length?m("",!0):(n(),b("div",pe,"(Sin subcategor\xEDas)"))],64))]),c("div",ye,[l(he,{outline:"",rounded:"","no-caps":"",icon:"category",label:t.subNombre?`Subcategor\xEDa: ${t.subNombre}`:"Subcategor\xEDas","content-class":"dropdown-subcats"},{default:d(()=>[l(ne,null,{default:d(()=>[V((n(),g(z,{clickable:"",onClick:a[1]||(a[1]=s=>i.seleccionarSubcat(null))},{default:d(()=>[l(S,{avatar:""},{default:d(()=>[l(_,{name:"grid_view"})]),_:1}),l(S,null,{default:d(()=>[y("Todas")]),_:1}),l(S,{side:""},{default:d(()=>[t.subId===null?(n(),g(_,{key:0,name:"check"})):m("",!0)]),_:1})]),_:1})),[[j]]),(n(!0),b(P,null,q(t.subcategorias,s=>V((n(),g(z,{key:s.id,clickable:"",onClick:k=>i.seleccionarSubcat(s.id)},{default:d(()=>[l(S,{avatar:""},{default:d(()=>[l(_,{name:"label"})]),_:1}),l(S,null,{default:d(()=>[y(h(s.name),1)]),_:2},1024),l(S,{side:""},{default:d(()=>[Number(t.subId)===Number(s.id)?(n(),g(_,{key:0,name:"check"})):m("",!0)]),_:2},1024)]),_:2},1032,["onClick"])),[[j]])),128))]),_:1})]),_:1},8,["label"])]),c("div",Se,[c("h2",ke,[y(" Categor\xEDa: "+h(t.categoriaNombre)+" ",1),t.subNombre?(n(),b("span",we,"\xB7 "+h(t.subNombre),1)):m("",!0)]),t.totalPages>1?(n(),b("div",Pe,[l(f,{flat:"",label:"Anterior",disabled:t.currentPage===1,onClick:a[2]||(a[2]=s=>i.cambiarPagina(t.currentPage-1))},null,8,["disabled"]),c("span",null,h(t.currentPage)+" / "+h(t.totalPages),1),l(f,{flat:"",label:"Siguiente",disabled:t.currentPage===t.totalPages,onClick:a[3]||(a[3]=s=>i.cambiarPagina(t.currentPage+1))},null,8,["disabled"])])):m("",!0),t.loading?(n(),b("div",Ce,[l(re,{size:"50px",color:"primary"})])):t.isFetched&&t.productos.length===0?(n(),b("div",Be,[l(_,{name:"sentiment_dissatisfied",size:"80px",color:"grey-5"}),qe])):(n(),b("div",Ne,[c("div",xe,[(n(!0),b(P,null,q(t.productos,s=>(n(),g(te,{key:s.id,class:"product-card-personalizada",flat:"",onClick:k=>i.clickDetalleProducto(s)},{default:d(()=>[l(ce,{src:i.resolverImagen(s),style:{height:"160px","object-fit":"cover"}},{default:d(()=>[s.stockDisponible==="Sin Stock"?(n(),b("div",Ie,Qe)):m("",!0),Number(s.porcentaje)>0?(n(),g(le,{key:1,color:"red",floating:""},{default:d(()=>[y("-"+h(s.porcentaje)+"%",1)]),_:2},1024)):m("",!0)]),_:2},1032,["src"]),l(ae,{class:"q-pa-sm text-center"},{default:d(()=>[c("div",Ae,h(s.nombre),1),c("div",Ve,[s.precioNormal?(n(),b("div",je,[ze,He,c("strong",null,"Bs. "+h(s.precioNormal),1)])):m("",!0),c("div",Le,[Me,Oe,c("strong",null,"Bs. "+h(s.precio),1)])])]),_:2},1024),s.stockDisponible==="Disponible"?(n(),g(f,{key:0,label:"A\xF1adir al carrito",icon:"shopping_cart",class:"q-mt-sm full-width",style:{"background-color":"#2D9CDB",color:"#fff"},glossy:"",unelevated:"","no-caps":""})):(n(),g(f,{key:1,label:"Agotado",icon:"remove_shopping_cart",class:"q-mt-sm full-width",style:{"background-color":"#d9534f",color:"#fff"},unelevated:"","no-caps":"",disabled:""}))]),_:2},1032,["onClick"]))),128))]),t.totalPages>1?(n(),b("div",Fe,[l(f,{flat:"",label:"Anterior",disabled:t.currentPage===1,onClick:a[4]||(a[4]=s=>i.cambiarPagina(t.currentPage-1))},null,8,["disabled"]),c("span",null,h(t.currentPage)+" / "+h(t.totalPages),1),l(f,{flat:"",label:"Siguiente",disabled:t.currentPage===t.totalPages,onClick:a[5]||(a[5]=s=>i.cambiarPagina(t.currentPage+1))},null,8,["disabled"])])):m("",!0)]))])]),_:1})}var Ze=ee(me,[["render",Re],["__scopeId","data-v-e0bdd91a"]]);export{Ze as default};
