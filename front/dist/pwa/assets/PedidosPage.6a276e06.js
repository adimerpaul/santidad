import{_ as z,d as G,o as p,k as x,w as i,y as T,q as s,a as o,i as w,g as _,z as R,A as c,f as g,v as P,B,p as u,c as y,F as O,C as M,n as v,D as L,t as n,G as k,H as F,Q as q,J as S,j as b,K as I,L as Y,M as j,O as V,P as H,R as Q,s as J,S as K,T as U,U as W,V as X,W as N,e as Z,X as A,Y as D,m as C,Z as E,$,a0 as ee}from"./index.3cd01b8b.js";const oe={name:"PedidosPage",data(){return{agencia_id:parseInt(localStorage.getItem("agencia_id")),agenciaNombre:"",pedidoDialog:!1,pedido:{solicitante:"",observacion:"",proveedor_id:null,vendedor_id:null},proveedores:[],proveedoresAll:[],vendedores:[],current_page:1,last_page:1,ruleNumber:[e=>e!==null&&e!==""||"Por favor escriba su cantidad",e=>e>=0&&e<1e4||"Por favor escriba una cantidad real"],search:"",loading:!1,products:[],totalProducts:0,agencias:[],productosPedido:[],category:0,categories:[{name:"Ver todas las categorias",id:0}],order:"cantidad desc",columnsPedidos:[{label:"borrar",field:"borrar",name:"borrar",align:"left"},{label:"nombre",field:"nombre",name:"nombre",align:"left"},{label:"cantidadPedida",field:"cantidadPedida",name:"cantidadPedida"}],columnsResumenPedido:[{name:"producto",label:"Producto",field:"nombre",align:"left"},{name:"stock",label:"Stock Actual",field:"cantidad",align:"center"},{name:"cantidad",label:"Cantidad Pedida",field:"cantidadPedida",align:"center"}],orders:[{label:"Ordenar por",value:"id"},{label:"Menor precio",value:"precio asc"},{label:"Mayor precio",value:"precio desc"},{label:"Menor cantidad",value:"cantidad asc"},{label:"Mayor cantidad",value:"cantidad desc"},{label:"Orden alfabetico",value:"nombre asc"}],subcategories:[],subcategoria:""}},computed:{totalItemsPedido(){let e=0;return this.productosPedido.forEach(t=>{e+=parseInt(t.cantidadPedida||0)}),e}},async mounted(){await this.cargarInformacionUsuario(),this.productsGet(),this.categoriesGet(),this.subcategoriesGet(),this.proveedoresGet()},methods:{proveedoresGet(){this.$axios.get("providers").then(e=>{this.proveedores=e.data,this.proveedoresAll=e.data}).catch(e=>{console.error("Error cargando proveedores",e)})},filterProveedores(e,t,r){if(e===""){t(()=>{this.proveedores=this.proveedoresAll});return}const h=e.toLowerCase();t(()=>{this.proveedores=this.proveedoresAll.filter(a=>a.nombreRazonSocial.toLowerCase().indexOf(h)>-1)})},cargarVendedores(e){this.pedido.vendedor_id=null,this.vendedores=[],e&&this.$axios.get(`vendedores-por-proveedor/${e}`).then(t=>{this.vendedores=t.data,this.vendedores.length===1&&(this.pedido.vendedor_id=this.vendedores[0].id)}).catch(t=>{console.error(t)})},async cargarInformacionUsuario(){try{const e=await this.$axios.get("agencias");this.agencias=e.data;const t=this.agencias.find(r=>r.id===this.agencia_id);if(t&&(this.agenciaNombre=t.nombre),this.$store.user&&this.$store.user.name)this.pedido.solicitante=this.$store.user.name;else try{const r=await this.$axios.get(`users/agencia/${this.agencia_id}`);r.data&&r.data.length>0&&(this.pedido.solicitante=r.data[0].name||"")}catch{console.log("No se pudo obtener usuarios de la agencia, usando valor por defecto"),this.pedido.solicitante="Usuario Sucursal "+this.agencia_id}}catch(e){console.error("Error al cargar informaci\xF3n del usuario:",e),this.agenciaNombre="Sucursal "+this.agencia_id,this.pedido.solicitante="Usuario Sucursal "+this.agencia_id}},getProductCardClass(e){return"bg-white cursor-pointer"},getStockTextClass(e){return e.cantidad<=0?"text-center text-bold text-red":e.cantidad<=5?"text-center text-bold text-orange":"text-center text-bold"},getCantidadEnPedido(e){const t=this.productosPedido.find(r=>r.id===e);return t?t.cantidadPedida:0},clickAddPedido(e){const t=this.productosPedido.find(r=>r.id===e.id);if(t)t.cantidadPedida++;else{const r={...e,cantidadPedida:1};this.productosPedido.push(r)}},addCantidadPedido(e,t){e.cantidadPedida++},removeCantidadPedido(e,t){e.cantidadPedida--,e.cantidadPedida<=0&&this.productosPedido.splice(t,1)},cambioNumeroPedido(e,t){if(e.cantidadPedida!==""){const r=parseInt(e.cantidadPedida);isNaN(r)||(e.cantidadPedida=r),r<=0&&this.productosPedido.splice(t,1)}},deleteProductoPedido(e,t){this.productosPedido.splice(t,1)},vaciarPedido(){this.$q.dialog({title:"Vaciar pedido",message:"\xBFEst\xE1s seguro de vaciar todo el pedido?",cancel:!0,persistent:!0}).onOk(()=>{this.productosPedido=[]})},clickConfirmarPedido(){if(this.productosPedido.length===0){this.$q.notify({color:"negative",message:"No hay productos en el pedido",icon:"warning"});return}let e=!1;this.productosPedido.forEach(t=>{(!t.cantidadPedida||t.cantidadPedida<=0)&&(this.$alert.error(`La cantidad de "${t.nombre}" debe ser mayor a 0.`),e=!0)}),!e&&(this.pedidoDialog=!0)},pedidoInsert(){var r;if(!this.pedido.proveedor_id){this.$q.notify({color:"warning",message:"Debe seleccionar un proveedor"});return}this.loading=!0;const e=G.formatDate(Date.now(),"YYYY-MM-DD HH:mm:ss"),t={agencia_id:this.agencia_id,user_id:((r=this.$store.user)==null?void 0:r.id)||null,fecha_pedido:e,estado:"PENDIENTE",observacion:this.pedido.observacion,proveedor_id:this.pedido.proveedor_id,vendedor_id:this.pedido.vendedor_id,detalles:this.productosPedido.map(h=>({product_id:h.id,cantidad:h.cantidadPedida}))};this.$axios.post("pedidos",t).then(h=>{this.loading=!1,this.$alert.success("Pedido realizado con \xE9xito"),this.pedidoDialog=!1,this.productosPedido=[],this.pedido.observacion="",this.pedido.proveedor_id=null,this.productsGet()}).catch(h=>{var a,l;this.loading=!1,this.$alert.error(((l=(a=h.response)==null?void 0:a.data)==null?void 0:l.message)||"Error al realizar el pedido")})},subcategoriesGet(){this.$axios.get("subcategories").then(e=>{this.subcategories=e.data}).catch(e=>{console.log(e)})},categoriesGet(){this.categories=[{name:"Ver todas las categorias",id:0}],this.$axios.get("categories").then(e=>{this.categories=this.categories.concat(e.data)}).catch(e=>{console.log(e)})},productsGet(){this.loading=!0,this.products=[],this.$axios.get(`productsSale?page=${this.current_page}&search=${this.search}&order=${this.order}&category=${this.category}&agencia=${this.agencia_id}&subcategory=${this.subcategoria}`).then(e=>{this.loading=!1,this.totalProducts=e.data.products.total,this.last_page=e.data.products.last_page,this.current_page=e.data.products.current_page,e.data.products.data.forEach(t=>{t.cantidadPedida=this.getCantidadEnPedido(t.id),this.products.push(t)})}).catch(e=>{this.loading=!1,console.log(e)})}}},f=e=>($("data-v-b53feacc"),e=e(),ee(),e),de={class:"row"},te={class:"col-12 col-md-8"},ae={class:"row"},ie={class:"col-12 col-md-6 bg-white q-pa-xs"},se={class:"col-12 col-md-6 flex q-pa-xs"},le={class:"col-12 col-md-3 q-pa-xs"},re={class:"col-12 col-md-3 q-pa-xs"},ne={class:"col-12 col-md-3 q-pa-xs"},ce={class:"col-12 col-md-3 q-pa-xs"},ue={class:"col-12 flex flex-center"},pe={class:"col-12"},ge={key:0,class:"row cursor-pointer"},he={class:"absolute-bottom text-center text-subtitle2",style:{padding:"0px 0px","line-height":"1"}},me={class:"text-center text-subtitle2"},_e={key:0,class:"text-center text-caption text-lead"},ve={class:"row"},be={class:"col-12 flex flex-center"},fe=f(()=>s("div",{class:"col-12"},[s("div",{class:"text-bold text-grey text-center"},"No encontramos productos para tu b\xFAsqueda."),s("div",{class:"text-bold text-grey text-center"},"Intenta con otra palabra o revisa tu Inventario.")],-1)),xe={class:"col-12 col-md-4"},Pe={class:"row"},ye={class:"col-6 text-h6 q-pt-xs q-pl-lg"},we={class:"col-6 text-right"},Ve={key:0,class:"flex flex-center q-pa-lg"},ke=f(()=>s("div",{class:"q-pa-lg text-grey text-center noSelect"}," A\xFAn no tienes productos en tu pedido. Haz clic sobre un producto para agregarlo. ",-1)),Ce={style:{"padding-left":"42px"}},qe={class:"text-caption",style:{"max-width":"120px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},Se={class:"text-grey"},Ie={class:"text-right text-grey-8 text-bold"},Qe={class:"row"},Ue=f(()=>s("div",{class:"col-7 text-grey"},"Productos diferentes",-1)),Ne={class:"col-5 text-right"},Ae=f(()=>s("div",{class:"col-7 text-grey"},"Total unidades",-1)),De={class:"col-5 text-right text-green"},Ee=f(()=>s("div",{class:"text-h6"},"Realizar pedido",-1)),ze={class:"row q-col-gutter-md"},Ge={class:"col-12 col-md-6"},Te={class:"col-12 col-md-6"},Re={class:"col-12"},Be={class:"col-12"},Oe={class:"col-12"},Me={class:"row"},Le={class:"col-12"},Fe=f(()=>s("div",{class:"text-h6 text-center"},"Resumen del Pedido",-1)),Ye={class:"col-12 q-pt-md"},je={class:"text-subtitle1 text-center"},He={class:"row"},Je={class:"col-6"},Ke={class:"col-6"};function We(e,t,r,h,a,l){return p(),x(T,{class:"bg-grey-2 q-pa-xs"},{default:i(()=>[s("div",de,[s("div",te,[s("div",ae,[s("div",ie,[o(_,{outlined:"",modelValue:a.search,"onUpdate:modelValue":[t[0]||(t[0]=d=>a.search=d),l.productsGet],label:"Buscar producto",dense:"",clearable:"",debounce:"500"},{prepend:i(()=>[o(w,{name:"search",class:"cursor-pointer"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),s("div",se,[o(g,{loading:a.loading,icon:"refresh",dense:"",label:"Actualizar",color:"indigo","no-caps":"",class:"text-bold",onClick:l.productsGet},{default:i(()=>[o(R,null,{default:i(()=>[c("Actualizar")]),_:1})]),_:1},8,["loading","onClick"])]),s("div",le,[o(P,{class:"bg-white","emit-value":"","map-options":"",dense:"",outlined:"",modelValue:a.category,"onUpdate:modelValue":[t[1]||(t[1]=d=>a.category=d),l.productsGet],"option-value":"id","option-label":"name",options:a.categories},null,8,["modelValue","options","onUpdate:modelValue"])]),s("div",re,[o(P,{class:"bg-white","emit-value":"","map-options":"",dense:"",outlined:"",modelValue:a.subcategoria,"onUpdate:modelValue":[t[2]||(t[2]=d=>a.subcategoria=d),l.productsGet],"option-value":"id","option-label":"name",options:a.subcategories,label:"Subcategor\xEDa"},null,8,["modelValue","options","onUpdate:modelValue"])]),s("div",ne,[o(P,{class:"bg-white",label:"Ordenar",dense:"",outlined:"",modelValue:a.order,"onUpdate:modelValue":[t[3]||(t[3]=d=>a.order=d),l.productsGet],options:a.orders,"map-options":"","emit-value":"","option-value":"value","option-label":"label"},null,8,["modelValue","options","onUpdate:modelValue"])]),s("div",ce,[o(_,{dense:"",outlined:"",readonly:"","model-value":a.agenciaNombre,label:"Sucursal","bg-color":"white"},null,8,["model-value"])]),s("div",ue,[o(B,{modelValue:a.current_page,"onUpdate:modelValue":[t[4]||(t[4]=d=>a.current_page=d),l.productsGet],max:a.last_page,"max-pages":6,"boundary-numbers":""},null,8,["modelValue","max","onUpdate:modelValue"])]),s("div",pe,[o(v,null,{default:i(()=>[o(u,{class:"q-pa-none"},{default:i(()=>[a.products.length>0?(p(),y("div",ge,[(p(!0),y(O,null,M(a.products,d=>(p(),y("div",{class:"col-4 col-md-2",key:d.id},[o(v,{onClick:m=>l.clickAddPedido(d),class:A(["q-pa-xs",l.getProductCardClass(d)]),flat:"",bordered:""},{default:i(()=>[o(I,{src:d.imagen.includes("http")?d.imagen:`${e.$url}../images/${d.imagen}`,width:"100%",height:"100px"},{default:i(()=>[d.porcentaje?(p(),x(D,{key:0,color:"red",floating:"",style:{padding:"10px 10px 5px 5px",margin:"0px"}},{default:i(()=>[c(n(d.porcentaje)+"% ",1)]),_:2},1024)):C("",!0),s("div",he,n(e.$filters.capitalize(d.nombre)),1),l.getCantidadEnPedido(d.id)>0?(p(),x(D,{key:1,color:"yellow-9",floating:"",label:l.getCantidadEnPedido(d.id),style:{padding:"5px"}},null,8,["label"])):C("",!0)]),_:2},1032,["src"]),o(u,{class:"q-pa-none q-ma-none"},{default:i(()=>[s("div",me,n(d.precio)+" Bs ",1),s("div",{class:A(l.getStockTextClass(d))},n(d.cantidad)+" "+n(e.$q.screen.lt.md?"Dis":"Disponible"),3),a.agencia_id==1&&d.cantidadAlmacen!==void 0?(p(),y("div",_e," Stock Almac\xE9n: "+n(d.cantidadAlmacen),1)):C("",!0)]),_:2},1024)]),_:2},1032,["onClick","class"])]))),128))])):(p(),x(v,{key:1},{default:i(()=>[o(u,null,{default:i(()=>[s("div",ve,[s("div",be,[o(L,{size:"150px","font-size":"150px",color:"white","text-color":"grey",icon:"view_in_ar"})]),fe])]),_:1})]),_:1}))]),_:1})]),_:1})])])]),s("div",xe,[o(v,null,{default:i(()=>[o(u,{class:"q-pa-none q-ma-none"},{default:i(()=>[s("div",Pe,[s("div",ye," Pedido ("+n(a.productosPedido.length)+") ",1),s("div",we,[o(g,{class:"text-subtitle1 text-blue-10 text-bold",style:{"text-decoration":"underline"},label:"Vaciar pedido",onClick:l.vaciarPedido,"no-caps":"",flat:"",outline:""},null,8,["onClick"])])])]),_:1}),o(k),o(u,{class:"q-pa-none q-ma-none"},{default:i(()=>[a.productosPedido.length==0?(p(),y("div",Ve,[o(w,{name:"o_shopping_basket",color:"grey",size:"100px"}),ke])):(p(),x(F,{key:1,style:{height:"400px"}},{default:i(()=>[o(q,{dense:"",flat:"",bordered:"","hide-bottom":"","hide-header":"",rows:a.productosPedido,columns:a.columnsPedidos,"rows-per-page-options":[0]},{body:i(d=>[o(S,{props:d},{default:i(()=>[o(b,{key:"borrar",props:d,style:{padding:"0px",margin:"0px"},"auto-width":""},{default:i(()=>[o(g,{flat:"",dense:"",onClick:m=>l.deleteProductoPedido(d.row,d.pageIndex),icon:"delete",color:"red",size:"10px",class:"q-pa-none q-ma-none"},null,8,["onClick"])]),_:2},1032,["props"]),o(b,{key:"nombre",props:d},{default:i(()=>[s("div",null,[o(I,{src:d.row.imagen.includes("http")?d.row.imagen:`${e.$url}../images/${d.row.imagen}`,width:"40px",height:"40px",style:{padding:"0px",margin:"0px","border-radius":"0px",position:"absolute",crop:"auto","object-fit":"cover"}},null,8,["src"]),s("div",Ce,[s("div",qe,n(d.row.nombre),1),s("div",Se,"Stock Actual: "+n(d.row.cantidad),1)])])]),_:2},1032,["props"]),o(b,{key:"cantidadPedida",props:d},{default:i(()=>[o(_,{dense:"",outlined:"","bottom-slots":"",min:"1",modelValue:d.row.cantidadPedida,"onUpdate:modelValue":[m=>d.row.cantidadPedida=m,m=>l.cambioNumeroPedido(d.row,d.pageIndex)],rules:a.ruleNumber,type:"number","input-class":"text-center",required:""},{prepend:i(()=>[o(g,{style:{cursor:"pointer"},dense:"",flat:"",icon:"remove_circle_outline",onClick:m=>l.removeCantidadPedido(d.row,d.pageIndex)},null,8,["onClick"])]),append:i(()=>[o(g,{style:{cursor:"pointer"},dense:"",flat:"",icon:"add_circle_outline",onClick:m=>l.addCantidadPedido(d.row,d.pageIndex)},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","rules"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1}))]),_:1}),o(u,null,{default:i(()=>[o(Y,{padding:"",bordered:"",dense:"",class:"rounded-borders full-width q-pa-none q-ma-none"},{default:i(()=>[o(j,{dense:"","dense-toggle":"","expand-separator":"",label:"Resumen"},{header:i(()=>[o(V,null,{default:i(()=>[c("Total Items")]),_:1}),o(V,{side:""},{default:i(()=>[s("div",Ie,n(l.totalItemsPedido),1)]),_:1})]),default:i(()=>[o(v,null,{default:i(()=>[o(u,null,{default:i(()=>[s("div",Qe,[Ue,s("div",Ne,n(a.productosPedido.length),1),Ae,s("div",De,n(l.totalItemsPedido),1)])]),_:1})]),_:1})]),_:1})]),_:1}),o(g,{onClick:l.clickConfirmarPedido,class:"full-width","no-caps":"",label:"Confirmar pedido",color:a.productosPedido.length==0?"grey":"primary",disable:a.productosPedido.length==0,loading:a.loading},null,8,["onClick","color","disable","loading"])]),_:1})]),_:1})])]),o(Z,{modelValue:a.pedidoDialog,"onUpdate:modelValue":t[9]||(t[9]=d=>a.pedidoDialog=d),persistent:""},{default:i(()=>[o(v,{style:{width:"850px","max-width":"90vw"}},{default:i(()=>[o(u,{class:"row items-center q-pb-none"},{default:i(()=>[Ee,o(H),Q(o(g,{flat:"",round:"",dense:"",icon:"close"},null,512),[[E]])]),_:1}),o(J,{onSubmit:K(l.pedidoInsert,["prevent"])},{default:i(()=>[o(u,null,{default:i(()=>[s("div",ze,[s("div",Ge,[o(_,{outlined:"",dense:"",label:"Solicitante",required:"",modelValue:a.pedido.solicitante,"onUpdate:modelValue":t[5]||(t[5]=d=>a.pedido.solicitante=d),style:{"text-transform":"uppercase"},readonly:""},null,8,["modelValue"])]),s("div",Te,[o(_,{outlined:"",dense:"",label:"Sucursal","model-value":a.agenciaNombre,readonly:"","bg-color":"grey-2"},null,8,["model-value"])]),s("div",Re,[o(P,{outlined:"",dense:"",label:"Proveedor para este pedido",modelValue:a.pedido.proveedor_id,"onUpdate:modelValue":[t[6]||(t[6]=d=>a.pedido.proveedor_id=d),l.cargarVendedores],options:a.proveedores,"option-value":"id","option-label":"nombreRazonSocial","emit-value":"","map-options":"","use-input":"",onFilter:l.filterProveedores,rules:[d=>!!d||"Debe seleccionar un proveedor"],"bg-color":"white"},{prepend:i(()=>[o(w,{name:"local_shipping"})]),_:1},8,["modelValue","options","onFilter","onUpdate:modelValue","rules"])]),s("div",Be,[o(P,{outlined:"",dense:"",label:"Vendedor (Opcional)",modelValue:a.pedido.vendedor_id,"onUpdate:modelValue":t[7]||(t[7]=d=>a.pedido.vendedor_id=d),options:a.vendedores,"option-value":"id","option-label":"nombre","emit-value":"","map-options":"","bg-color":"white",disable:!a.pedido.proveedor_id},{prepend:i(()=>[o(w,{name:"badge"})]),"no-option":i(()=>[o(U,null,{default:i(()=>[o(V,{class:"text-grey"},{default:i(()=>[c(n(a.pedido.proveedor_id?"Sin vendedores registrados":"Seleccione proveedor primero"),1)]),_:1})]),_:1})]),option:i(d=>[o(U,W(X(d.itemProps)),{default:i(()=>[o(V,null,{default:i(()=>[o(N,null,{default:i(()=>[c(n(d.opt.nombre),1)]),_:2},1024),o(N,{caption:""},{default:i(()=>[c(n(d.opt.celular),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","disable"])]),s("div",Oe,[o(_,{outlined:"",dense:"",label:"Observaciones (Opcional)",modelValue:a.pedido.observacion,"onUpdate:modelValue":t[8]||(t[8]=d=>a.pedido.observacion=d),type:"textarea",rows:"2"},null,8,["modelValue"])])])]),_:1}),o(k),o(u,null,{default:i(()=>[s("div",Me,[s("div",Le,[Fe,o(q,{dense:"",rows:a.productosPedido,columns:a.columnsResumenPedido,"row-key":"id","hide-pagination":""},{body:i(d=>[o(S,{props:d},{default:i(()=>[o(b,{key:"producto"},{default:i(()=>[c(n(d.row.nombre),1)]),_:2},1024),o(b,{key:"stock"},{default:i(()=>[c(n(d.row.cantidad),1)]),_:2},1024),o(b,{key:"cantidad"},{default:i(()=>[c(n(d.row.cantidadPedida),1)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),s("div",Ye,[s("div",je,[c(" Total: "),s("strong",null,n(a.productosPedido.length),1),c(" productos | "),s("strong",null,n(l.totalItemsPedido),1),c(" unidades ")])])])]),_:1}),o(k),o(u,null,{default:i(()=>[s("div",He,[s("div",Je,[o(g,{type:"submit",class:"full-width",icon:"o_send",label:"Enviar pedido",loading:a.loading,"no-caps":"",color:"green"},null,8,["loading"])]),s("div",Ke,[Q(o(g,{class:"full-width",icon:"undo",label:"Atr\xE1s","no-caps":"",color:"red",loading:a.loading},null,8,["loading"]),[[E]])])])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}var Ze=z(oe,[["render",We],["__scopeId","data-v-b53feacc"]]);export{Ze as default};
