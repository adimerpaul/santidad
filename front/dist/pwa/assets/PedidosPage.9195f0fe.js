import{_ as G,o as p,k as x,w as i,y as D,q as s,a as e,i as w,g as m,z as T,A as c,f as g,v as P,B as R,p as u,c as y,F as O,C as B,n as _,D as L,t as r,G as k,H as M,Q as q,J as S,j as v,K as I,L as F,M as j,O as V,P as H,R as Q,s as J,S as K,T as U,U as W,V as X,W as N,e as Y,X as A,Y as E,m as C,Z as z,$ as Z,a0 as $}from"./index.71bc0bf9.js";const ee={name:"PedidosPage",data(){return{agencia_id:parseInt(localStorage.getItem("agencia_id")),agenciaNombre:"",pedidoDialog:!1,pedido:{solicitante:"",observacion:"",proveedor_id:null,vendedor_id:null},proveedores:[],proveedoresAll:[],vendedores:[],current_page:1,last_page:1,ruleNumber:[o=>o!==null&&o!==""||"Por favor escriba su cantidad",o=>o>=0&&o<1e4||"Por favor escriba una cantidad real"],search:"",loading:!1,products:[],totalProducts:0,agencias:[],productosPedido:[],category:0,categories:[{name:"Ver todas las categorias",id:0}],order:"cantidad desc",columnsPedidos:[{label:"borrar",field:"borrar",name:"borrar",align:"left"},{label:"nombre",field:"nombre",name:"nombre",align:"left"},{label:"cantidadPedida",field:"cantidadPedida",name:"cantidadPedida"}],columnsResumenPedido:[{name:"producto",label:"Producto",field:"nombre",align:"left"},{name:"stock",label:"Stock Actual",field:"cantidad",align:"center"},{name:"cantidad",label:"Cantidad Pedida",field:"cantidadPedida",align:"center"}],orders:[{label:"Ordenar por",value:"id"},{label:"Menor precio",value:"precio asc"},{label:"Mayor precio",value:"precio desc"},{label:"Menor cantidad",value:"cantidad asc"},{label:"Mayor cantidad",value:"cantidad desc"},{label:"Orden alfabetico",value:"nombre asc"}],subcategories:[],subcategoria:""}},computed:{totalItemsPedido(){let o=0;return this.productosPedido.forEach(a=>{o+=parseInt(a.cantidadPedida||0)}),o}},async mounted(){await this.cargarInformacionUsuario(),this.productsGet(),this.categoriesGet(),this.subcategoriesGet(),this.proveedoresGet()},methods:{proveedoresGet(){this.$axios.get("providers").then(o=>{this.proveedores=o.data,this.proveedoresAll=o.data}).catch(o=>{console.error("Error cargando proveedores",o)})},filterProveedores(o,a,n){if(o===""){a(()=>{this.proveedores=this.proveedoresAll});return}const f=o.toLowerCase();a(()=>{this.proveedores=this.proveedoresAll.filter(t=>t.nombreRazonSocial.toLowerCase().indexOf(f)>-1)})},cargarVendedores(o){this.pedido.vendedor_id=null,this.vendedores=[],o&&this.$axios.get(`vendedores-por-proveedor/${o}`).then(a=>{this.vendedores=a.data,this.vendedores.length===1&&(this.pedido.vendedor_id=this.vendedores[0].id)}).catch(a=>{console.error(a)})},async cargarInformacionUsuario(){try{const o=await this.$axios.get("agencias");this.agencias=o.data;const a=this.agencias.find(n=>n.id===this.agencia_id);if(a&&(this.agenciaNombre=a.nombre),this.$store.user&&this.$store.user.name)this.pedido.solicitante=this.$store.user.name;else try{const n=await this.$axios.get(`users/agencia/${this.agencia_id}`);n.data&&n.data.length>0&&(this.pedido.solicitante=n.data[0].name||"")}catch{console.log("No se pudo obtener usuarios de la agencia, usando valor por defecto"),this.pedido.solicitante="Usuario Sucursal "+this.agencia_id}}catch(o){console.error("Error al cargar informaci\xF3n del usuario:",o),this.agenciaNombre="Sucursal "+this.agencia_id,this.pedido.solicitante="Usuario Sucursal "+this.agencia_id}},getProductCardClass(o){return"bg-white cursor-pointer"},getStockTextClass(o){return o.cantidad<=0?"text-center text-bold text-red":o.cantidad<=5?"text-center text-bold text-orange":"text-center text-bold"},getCantidadEnPedido(o){const a=this.productosPedido.find(n=>n.id===o);return a?a.cantidadPedida:0},clickAddPedido(o){const a=this.productosPedido.find(n=>n.id===o.id);if(a)a.cantidadPedida++;else{const n={...o,cantidadPedida:1};this.productosPedido.push(n)}},addCantidadPedido(o,a){o.cantidadPedida++},removeCantidadPedido(o,a){o.cantidadPedida--,o.cantidadPedida<=0&&this.productosPedido.splice(a,1)},cambioNumeroPedido(o,a){if(o.cantidadPedida!==""){const n=parseInt(o.cantidadPedida);isNaN(n)||(o.cantidadPedida=n),n<=0&&this.productosPedido.splice(a,1)}},deleteProductoPedido(o,a){this.productosPedido.splice(a,1)},vaciarPedido(){this.$q.dialog({title:"Vaciar pedido",message:"\xBFEst\xE1s seguro de vaciar todo el pedido?",cancel:!0,persistent:!0}).onOk(()=>{this.productosPedido=[]})},clickConfirmarPedido(){if(this.productosPedido.length===0){this.$q.notify({color:"negative",message:"No hay productos en el pedido",icon:"warning"});return}let o=!1;this.productosPedido.forEach(a=>{(!a.cantidadPedida||a.cantidadPedida<=0)&&(this.$alert.error(`La cantidad de "${a.nombre}" debe ser mayor a 0.`),o=!0)}),!o&&(this.pedidoDialog=!0)},pedidoInsert(){var f;if(!this.pedido.proveedor_id){this.$q.notify({color:"warning",message:"Debe seleccionar un proveedor"});return}this.loading=!0;const a=new Date().toISOString().split("T")[0],n={agencia_id:this.agencia_id,user_id:((f=this.$store.user)==null?void 0:f.id)||null,fecha_pedido:a,estado:"PENDIENTE",observacion:this.pedido.observacion,proveedor_id:this.pedido.proveedor_id,vendedor_id:this.pedido.vendedor_id,detalles:this.productosPedido.map(t=>({product_id:t.id,cantidad:t.cantidadPedida}))};this.$axios.post("pedidos",n).then(t=>{this.loading=!1,this.$alert.success("Pedido realizado con \xE9xito"),this.pedidoDialog=!1,this.productosPedido=[],this.pedido.observacion="",this.pedido.proveedor_id=null,this.productsGet()}).catch(t=>{var l,d;this.loading=!1,this.$alert.error(((d=(l=t.response)==null?void 0:l.data)==null?void 0:d.message)||"Error al realizar el pedido")})},subcategoriesGet(){this.$axios.get("subcategories").then(o=>{this.subcategories=o.data}).catch(o=>{console.log(o)})},categoriesGet(){this.categories=[{name:"Ver todas las categorias",id:0}],this.$axios.get("categories").then(o=>{this.categories=this.categories.concat(o.data)}).catch(o=>{console.log(o)})},productsGet(){this.loading=!0,this.products=[],this.$axios.get(`productsSale?page=${this.current_page}&search=${this.search}&order=${this.order}&category=${this.category}&agencia=${this.agencia_id}&subcategory=${this.subcategoria}`).then(o=>{this.loading=!1,this.totalProducts=o.data.products.total,this.last_page=o.data.products.last_page,this.current_page=o.data.products.current_page,o.data.products.data.forEach(a=>{a.cantidadPedida=this.getCantidadEnPedido(a.id),this.products.push(a)})}).catch(o=>{this.loading=!1,console.log(o)})}}},b=o=>(Z("data-v-39c4e368"),o=o(),$(),o),oe={class:"row"},de={class:"col-12 col-md-8"},te={class:"row"},ae={class:"col-12 col-md-6 bg-white q-pa-xs"},ie={class:"col-12 col-md-6 flex q-pa-xs"},se={class:"col-12 col-md-3 q-pa-xs"},le={class:"col-12 col-md-3 q-pa-xs"},ne={class:"col-12 col-md-3 q-pa-xs"},re={class:"col-12 col-md-3 q-pa-xs"},ce={class:"col-12 flex flex-center"},ue={class:"col-12"},pe={key:0,class:"row cursor-pointer"},ge={class:"absolute-bottom text-center text-subtitle2",style:{padding:"0px 0px","line-height":"1"}},he={class:"text-center text-subtitle2"},me={key:0,class:"text-center text-caption text-lead"},_e={class:"row"},ve={class:"col-12 flex flex-center"},be=b(()=>s("div",{class:"col-12"},[s("div",{class:"text-bold text-grey text-center"},"No encontramos productos para tu b\xFAsqueda."),s("div",{class:"text-bold text-grey text-center"},"Intenta con otra palabra o revisa tu Inventario.")],-1)),fe={class:"col-12 col-md-4"},xe={class:"row"},Pe={class:"col-6 text-h6 q-pt-xs q-pl-lg"},ye={class:"col-6 text-right"},we={key:0,class:"flex flex-center q-pa-lg"},Ve=b(()=>s("div",{class:"q-pa-lg text-grey text-center noSelect"}," A\xFAn no tienes productos en tu pedido. Haz clic sobre un producto para agregarlo. ",-1)),ke={style:{"padding-left":"42px"}},Ce={class:"text-caption",style:{"max-width":"120px","white-space":"normal","overflow-wrap":"break-word","line-height":"0.9"}},qe={class:"text-grey"},Se={class:"text-right text-grey-8 text-bold"},Ie={class:"row"},Qe=b(()=>s("div",{class:"col-7 text-grey"},"Productos diferentes",-1)),Ue={class:"col-5 text-right"},Ne=b(()=>s("div",{class:"col-7 text-grey"},"Total unidades",-1)),Ae={class:"col-5 text-right text-green"},Ee=b(()=>s("div",{class:"text-h6"},"Realizar pedido",-1)),ze={class:"row q-col-gutter-md"},Ge={class:"col-12 col-md-6"},De={class:"col-12 col-md-6"},Te={class:"col-12"},Re={class:"col-12"},Oe={class:"col-12"},Be={class:"row"},Le={class:"col-12"},Me=b(()=>s("div",{class:"text-h6 text-center"},"Resumen del Pedido",-1)),Fe={class:"col-12 q-pt-md"},je={class:"text-subtitle1 text-center"},He={class:"row"},Je={class:"col-6"},Ke={class:"col-6"};function We(o,a,n,f,t,l){return p(),x(D,{class:"bg-grey-2 q-pa-xs"},{default:i(()=>[s("div",oe,[s("div",de,[s("div",te,[s("div",ae,[e(m,{outlined:"",modelValue:t.search,"onUpdate:modelValue":[a[0]||(a[0]=d=>t.search=d),l.productsGet],label:"Buscar producto",dense:"",clearable:"",debounce:"500"},{prepend:i(()=>[e(w,{name:"search",class:"cursor-pointer"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),s("div",ie,[e(g,{loading:t.loading,icon:"refresh",dense:"",label:"Actualizar",color:"indigo","no-caps":"",class:"text-bold",onClick:l.productsGet},{default:i(()=>[e(T,null,{default:i(()=>[c("Actualizar")]),_:1})]),_:1},8,["loading","onClick"])]),s("div",se,[e(P,{class:"bg-white","emit-value":"","map-options":"",dense:"",outlined:"",modelValue:t.category,"onUpdate:modelValue":[a[1]||(a[1]=d=>t.category=d),l.productsGet],"option-value":"id","option-label":"name",options:t.categories},null,8,["modelValue","options","onUpdate:modelValue"])]),s("div",le,[e(P,{class:"bg-white","emit-value":"","map-options":"",dense:"",outlined:"",modelValue:t.subcategoria,"onUpdate:modelValue":[a[2]||(a[2]=d=>t.subcategoria=d),l.productsGet],"option-value":"id","option-label":"name",options:t.subcategories,label:"Subcategor\xEDa"},null,8,["modelValue","options","onUpdate:modelValue"])]),s("div",ne,[e(P,{class:"bg-white",label:"Ordenar",dense:"",outlined:"",modelValue:t.order,"onUpdate:modelValue":[a[3]||(a[3]=d=>t.order=d),l.productsGet],options:t.orders,"map-options":"","emit-value":"","option-value":"value","option-label":"label"},null,8,["modelValue","options","onUpdate:modelValue"])]),s("div",re,[e(m,{dense:"",outlined:"",readonly:"","model-value":t.agenciaNombre,label:"Sucursal","bg-color":"white"},null,8,["model-value"])]),s("div",ce,[e(R,{modelValue:t.current_page,"onUpdate:modelValue":[a[4]||(a[4]=d=>t.current_page=d),l.productsGet],max:t.last_page,"max-pages":6,"boundary-numbers":""},null,8,["modelValue","max","onUpdate:modelValue"])]),s("div",ue,[e(_,null,{default:i(()=>[e(u,{class:"q-pa-none"},{default:i(()=>[t.products.length>0?(p(),y("div",pe,[(p(!0),y(O,null,B(t.products,d=>(p(),y("div",{class:"col-4 col-md-2",key:d.id},[e(_,{onClick:h=>l.clickAddPedido(d),class:A(["q-pa-xs",l.getProductCardClass(d)]),flat:"",bordered:""},{default:i(()=>[e(I,{src:d.imagen.includes("http")?d.imagen:`${o.$url}../images/${d.imagen}`,width:"100%",height:"100px"},{default:i(()=>[d.porcentaje?(p(),x(E,{key:0,color:"red",floating:"",style:{padding:"10px 10px 5px 5px",margin:"0px"}},{default:i(()=>[c(r(d.porcentaje)+"% ",1)]),_:2},1024)):C("",!0),s("div",ge,r(o.$filters.capitalize(d.nombre)),1),l.getCantidadEnPedido(d.id)>0?(p(),x(E,{key:1,color:"yellow-9",floating:"",label:l.getCantidadEnPedido(d.id),style:{padding:"5px"}},null,8,["label"])):C("",!0)]),_:2},1032,["src"]),e(u,{class:"q-pa-none q-ma-none"},{default:i(()=>[s("div",he,r(d.precio)+" Bs ",1),s("div",{class:A(l.getStockTextClass(d))},r(d.cantidad)+" "+r(o.$q.screen.lt.md?"Dis":"Disponible"),3),t.agencia_id==1&&d.cantidadAlmacen!==void 0?(p(),y("div",me," Stock Almac\xE9n: "+r(d.cantidadAlmacen),1)):C("",!0)]),_:2},1024)]),_:2},1032,["onClick","class"])]))),128))])):(p(),x(_,{key:1},{default:i(()=>[e(u,null,{default:i(()=>[s("div",_e,[s("div",ve,[e(L,{size:"150px","font-size":"150px",color:"white","text-color":"grey",icon:"view_in_ar"})]),be])]),_:1})]),_:1}))]),_:1})]),_:1})])])]),s("div",fe,[e(_,null,{default:i(()=>[e(u,{class:"q-pa-none q-ma-none"},{default:i(()=>[s("div",xe,[s("div",Pe," Pedido ("+r(t.productosPedido.length)+") ",1),s("div",ye,[e(g,{class:"text-subtitle1 text-blue-10 text-bold",style:{"text-decoration":"underline"},label:"Vaciar pedido",onClick:l.vaciarPedido,"no-caps":"",flat:"",outline:""},null,8,["onClick"])])])]),_:1}),e(k),e(u,{class:"q-pa-none q-ma-none"},{default:i(()=>[t.productosPedido.length==0?(p(),y("div",we,[e(w,{name:"o_shopping_basket",color:"grey",size:"100px"}),Ve])):(p(),x(M,{key:1,style:{height:"400px"}},{default:i(()=>[e(q,{dense:"",flat:"",bordered:"","hide-bottom":"","hide-header":"",rows:t.productosPedido,columns:t.columnsPedidos,"rows-per-page-options":[0]},{body:i(d=>[e(S,{props:d},{default:i(()=>[e(v,{key:"borrar",props:d,style:{padding:"0px",margin:"0px"},"auto-width":""},{default:i(()=>[e(g,{flat:"",dense:"",onClick:h=>l.deleteProductoPedido(d.row,d.pageIndex),icon:"delete",color:"red",size:"10px",class:"q-pa-none q-ma-none"},null,8,["onClick"])]),_:2},1032,["props"]),e(v,{key:"nombre",props:d},{default:i(()=>[s("div",null,[e(I,{src:d.row.imagen.includes("http")?d.row.imagen:`${o.$url}../images/${d.row.imagen}`,width:"40px",height:"40px",style:{padding:"0px",margin:"0px","border-radius":"0px",position:"absolute",crop:"auto","object-fit":"cover"}},null,8,["src"]),s("div",ke,[s("div",Ce,r(d.row.nombre),1),s("div",qe,"Stock Actual: "+r(d.row.cantidad),1)])])]),_:2},1032,["props"]),e(v,{key:"cantidadPedida",props:d},{default:i(()=>[e(m,{dense:"",outlined:"","bottom-slots":"",min:"1",modelValue:d.row.cantidadPedida,"onUpdate:modelValue":[h=>d.row.cantidadPedida=h,h=>l.cambioNumeroPedido(d.row,d.pageIndex)],rules:t.ruleNumber,type:"number","input-class":"text-center",required:""},{prepend:i(()=>[e(g,{style:{cursor:"pointer"},dense:"",flat:"",icon:"remove_circle_outline",onClick:h=>l.removeCantidadPedido(d.row,d.pageIndex)},null,8,["onClick"])]),append:i(()=>[e(g,{style:{cursor:"pointer"},dense:"",flat:"",icon:"add_circle_outline",onClick:h=>l.addCantidadPedido(d.row,d.pageIndex)},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","rules"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1}))]),_:1}),e(u,null,{default:i(()=>[e(F,{padding:"",bordered:"",dense:"",class:"rounded-borders full-width q-pa-none q-ma-none"},{default:i(()=>[e(j,{dense:"","dense-toggle":"","expand-separator":"",label:"Resumen"},{header:i(()=>[e(V,null,{default:i(()=>[c("Total Items")]),_:1}),e(V,{side:""},{default:i(()=>[s("div",Se,r(l.totalItemsPedido),1)]),_:1})]),default:i(()=>[e(_,null,{default:i(()=>[e(u,null,{default:i(()=>[s("div",Ie,[Qe,s("div",Ue,r(t.productosPedido.length),1),Ne,s("div",Ae,r(l.totalItemsPedido),1)])]),_:1})]),_:1})]),_:1})]),_:1}),e(g,{onClick:l.clickConfirmarPedido,class:"full-width","no-caps":"",label:"Confirmar pedido",color:t.productosPedido.length==0?"grey":"primary",disable:t.productosPedido.length==0,loading:t.loading},null,8,["onClick","color","disable","loading"])]),_:1})]),_:1})])]),e(Y,{modelValue:t.pedidoDialog,"onUpdate:modelValue":a[9]||(a[9]=d=>t.pedidoDialog=d),persistent:""},{default:i(()=>[e(_,{style:{width:"850px","max-width":"90vw"}},{default:i(()=>[e(u,{class:"row items-center q-pb-none"},{default:i(()=>[Ee,e(H),Q(e(g,{flat:"",round:"",dense:"",icon:"close"},null,512),[[z]])]),_:1}),e(J,{onSubmit:K(l.pedidoInsert,["prevent"])},{default:i(()=>[e(u,null,{default:i(()=>[s("div",ze,[s("div",Ge,[e(m,{outlined:"",dense:"",label:"Solicitante",required:"",modelValue:t.pedido.solicitante,"onUpdate:modelValue":a[5]||(a[5]=d=>t.pedido.solicitante=d),style:{"text-transform":"uppercase"},readonly:""},null,8,["modelValue"])]),s("div",De,[e(m,{outlined:"",dense:"",label:"Sucursal","model-value":t.agenciaNombre,readonly:"","bg-color":"grey-2"},null,8,["model-value"])]),s("div",Te,[e(P,{outlined:"",dense:"",label:"Proveedor para este pedido",modelValue:t.pedido.proveedor_id,"onUpdate:modelValue":[a[6]||(a[6]=d=>t.pedido.proveedor_id=d),l.cargarVendedores],options:t.proveedores,"option-value":"id","option-label":"nombreRazonSocial","emit-value":"","map-options":"","use-input":"",onFilter:l.filterProveedores,rules:[d=>!!d||"Debe seleccionar un proveedor"],"bg-color":"white"},{prepend:i(()=>[e(w,{name:"local_shipping"})]),_:1},8,["modelValue","options","onFilter","onUpdate:modelValue","rules"])]),s("div",Re,[e(P,{outlined:"",dense:"",label:"Vendedor (Opcional)",modelValue:t.pedido.vendedor_id,"onUpdate:modelValue":a[7]||(a[7]=d=>t.pedido.vendedor_id=d),options:t.vendedores,"option-value":"id","option-label":"nombre","emit-value":"","map-options":"","bg-color":"white",disable:!t.pedido.proveedor_id},{prepend:i(()=>[e(w,{name:"badge"})]),"no-option":i(()=>[e(U,null,{default:i(()=>[e(V,{class:"text-grey"},{default:i(()=>[c(r(t.pedido.proveedor_id?"Sin vendedores registrados":"Seleccione proveedor primero"),1)]),_:1})]),_:1})]),option:i(d=>[e(U,W(X(d.itemProps)),{default:i(()=>[e(V,null,{default:i(()=>[e(N,null,{default:i(()=>[c(r(d.opt.nombre),1)]),_:2},1024),e(N,{caption:""},{default:i(()=>[c(r(d.opt.celular),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","disable"])]),s("div",Oe,[e(m,{outlined:"",dense:"",label:"Observaciones (Opcional)",modelValue:t.pedido.observacion,"onUpdate:modelValue":a[8]||(a[8]=d=>t.pedido.observacion=d),type:"textarea",rows:"2"},null,8,["modelValue"])])])]),_:1}),e(k),e(u,null,{default:i(()=>[s("div",Be,[s("div",Le,[Me,e(q,{dense:"",rows:t.productosPedido,columns:t.columnsResumenPedido,"row-key":"id","hide-pagination":""},{body:i(d=>[e(S,{props:d},{default:i(()=>[e(v,{key:"producto"},{default:i(()=>[c(r(d.row.nombre),1)]),_:2},1024),e(v,{key:"stock"},{default:i(()=>[c(r(d.row.cantidad),1)]),_:2},1024),e(v,{key:"cantidad"},{default:i(()=>[c(r(d.row.cantidadPedida),1)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),s("div",Fe,[s("div",je,[c(" Total: "),s("strong",null,r(t.productosPedido.length),1),c(" productos | "),s("strong",null,r(l.totalItemsPedido),1),c(" unidades ")])])])]),_:1}),e(k),e(u,null,{default:i(()=>[s("div",He,[s("div",Je,[e(g,{type:"submit",class:"full-width",icon:"o_send",label:"Enviar pedido",loading:t.loading,"no-caps":"",color:"green"},null,8,["loading"])]),s("div",Ke,[Q(e(g,{class:"full-width",icon:"undo",label:"Atr\xE1s","no-caps":"",color:"red",loading:t.loading},null,8,["loading"]),[[z]])])])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}var Ye=G(ee,[["render",We],["__scopeId","data-v-39c4e368"]]);export{Ye as default};
